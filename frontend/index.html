<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pillulu Health Assistant | Your Smart Pillbox</title>
  <link rel="icon" href="icons8-pill-80.png" type="image/png">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Header + Disclaimer -->
  <header class="header">
    <div class="header-left">
      <h1 class="logo">
        <img src="icons8-pill-80.png" alt="" class="logo-icon">
        <span>Pillulu Health Assistant</span>
      </h1>
      <p class="tagline">Your AI medication copilot for smarter reminders and safer routines</p>
    </div>
    <div class="header-right">
      <span id="user-email" class="user-email hidden"></span>
      <button type="button" id="login-btn" class="btn btn-header">Login</button>
      <button type="button" id="logout-btn" class="btn btn-header hidden">Logout</button>
    </div>
  </header>

  <div class="disclaimer-banner">
    <strong>‚ö†Ô∏è Important:</strong> This app is for educational purposes only and does not provide medical advice. Always consult a doctor or pharmacist before making medication decisions.
  </div>

  <div class="app-layout">
    <!-- Left sidebar: User Profile -->
    <aside class="sidebar">
      <section class="section profile-section">
        <h2>üë§ User Profile</h2>
        <div id="profile-display" class="profile-display">
          <p class="profile-item"><span class="profile-label">Age:</span> <span id="profile-age">‚Äî</span></p>
          <p class="profile-item"><span class="profile-label">Height:</span> <span id="profile-height">‚Äî</span> cm</p>
          <p class="profile-item"><span class="profile-label">Weight:</span> <span id="profile-weight">‚Äî</span> kg</p>
          <p class="profile-item"><span class="profile-label">Location:</span> <span id="profile-location">‚Äî</span></p>
          <button type="button" id="profile-edit-btn" class="btn btn-secondary btn-small">Edit</button>
        </div>
        <div id="profile-login-prompt" class="profile-login-prompt hidden">
          <p>Log in to view and edit your profile.</p>
        </div>
      </section>
      <section class="section weather-section" id="weather-section">
        <h2>üå§Ô∏è Local Weather</h2>
        <div id="weather-widget" class="weather-widget hidden">
          <div class="weather-location" id="weather-location">‚Äî</div>
          <div class="weather-current">
            <div class="weather-temp" id="weather-temp">‚Äî</div>
            <div class="weather-desc" id="weather-desc">‚Äî</div>
            <div class="weather-details" id="weather-details"></div>
          </div>
          <div class="weather-forecast" id="weather-forecast"></div>
        </div>
        <div id="weather-empty" class="weather-empty">
          <p>Set your region in profile to see local weather.</p>
        </div>
        <p class="weather-attribution">Weather by <a href="https://open-meteo.com/" target="_blank" rel="noopener">Open-Meteo</a></p>
      </section>
      <footer class="page-footer">Jack Yu ¬© 2026.<br>Built with help of Cursor.</footer>
    </aside>

    <aside class="body-panel">
      <section class="section body-map-section">
        <h2>üßç Body Insight</h2>
        <p class="section-desc">Past cases are highlighted on body parts.</p>
        <div class="body-map-stage">
          <svg id="body-map-svg" class="body-map-svg" viewBox="0 0 220 460" role="img" aria-label="2D body map">
            <defs>
              <linearGradient id="bodyGlow" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" stop-color="#cae9ff"/>
                <stop offset="100%" stop-color="#9fd9ef"/>
              </linearGradient>
            </defs>
            <circle cx="110" cy="40" r="26" class="body-shape part-hotspot" data-body-part="head"></circle>
            <rect x="78" y="70" width="64" height="112" rx="28" class="body-shape part-hotspot" data-body-part="chest"></rect>
            <rect x="82" y="176" width="56" height="64" rx="20" class="body-shape part-hotspot" data-body-part="abdomen"></rect>
            <rect x="42" y="84" width="26" height="104" rx="12" class="body-shape part-hotspot" data-body-part="left_arm"></rect>
            <rect x="152" y="84" width="26" height="104" rx="12" class="body-shape part-hotspot" data-body-part="right_arm"></rect>
            <rect x="84" y="238" width="24" height="118" rx="12" class="body-shape part-hotspot" data-body-part="left_leg"></rect>
            <rect x="112" y="238" width="24" height="118" rx="12" class="body-shape part-hotspot" data-body-part="right_leg"></rect>
            <circle id="marker-head" class="body-marker hidden" data-body-part="head" cx="110" cy="40" r="8"></circle>
            <circle id="marker-chest" class="body-marker hidden" data-body-part="chest" cx="110" cy="120" r="8"></circle>
            <circle id="marker-abdomen" class="body-marker hidden" data-body-part="abdomen" cx="110" cy="204" r="8"></circle>
            <circle id="marker-left_arm" class="body-marker hidden" data-body-part="left_arm" cx="55" cy="126" r="7"></circle>
            <circle id="marker-right_arm" class="body-marker hidden" data-body-part="right_arm" cx="165" cy="126" r="7"></circle>
            <circle id="marker-left_leg" class="body-marker hidden" data-body-part="left_leg" cx="95" cy="286" r="7"></circle>
            <circle id="marker-right_leg" class="body-marker hidden" data-body-part="right_leg" cx="125" cy="286" r="7"></circle>
          </svg>
          <div id="body-part-tooltip" class="body-part-tooltip hidden"></div>
        </div>
        <div class="body-map-tools">
          <button type="button" id="clear-body-filter-btn" class="btn btn-secondary btn-small">Show all parts</button>
          <span id="active-body-filter" class="body-filter-label">Filter: all</span>
        </div>
      </section>

      <section class="section case-history-section">
        <h2>ü©∫ Past Cases</h2>
        <div class="case-header-tools">
          <button type="button" id="case-toggle-btn" class="btn btn-secondary btn-small hidden">Add case</button>
          <span id="case-login-hint" class="case-login-hint">Log in to add case records.</span>
        </div>
        <form id="case-form" class="case-form hidden">
          <label for="case-title">Case title *</label>
          <input type="text" id="case-title" maxlength="255" placeholder="e.g. Migraine flare-up" required>
          <label for="case-body-part">Body part *</label>
          <select id="case-body-part" required>
            <option value="">Select body part</option>
            <option value="head">Head</option>
            <option value="chest">Chest</option>
            <option value="abdomen">Abdomen</option>
            <option value="left_arm">Left arm</option>
            <option value="right_arm">Right arm</option>
            <option value="left_leg">Left leg</option>
            <option value="right_leg">Right leg</option>
          </select>
          <label for="case-status">Status</label>
          <select id="case-status">
            <option value="active">Active</option>
            <option value="resolved">Resolved</option>
            <option value="chronic">Chronic</option>
          </select>
          <label for="case-severity">Severity (1-10)</label>
          <input type="number" id="case-severity" min="1" max="10" value="3">
          <label>Occurred on (YYYY-MM-DD)</label>
          <div class="case-date-group">
            <input type="text" id="case-date-year" inputmode="numeric" pattern="[0-9]*" maxlength="4" placeholder="YYYY" aria-label="Year">
            <input type="text" id="case-date-month" inputmode="numeric" pattern="[0-9]*" maxlength="2" placeholder="MM" aria-label="Month">
            <input type="text" id="case-date-day" inputmode="numeric" pattern="[0-9]*" maxlength="2" placeholder="DD" aria-label="Day">
            <button type="button" id="case-date-today-btn" class="btn btn-secondary btn-small">Today</button>
          </div>
          <label for="case-notes">Notes (optional)</label>
          <textarea id="case-notes" rows="2" maxlength="2000" placeholder="Symptoms, diagnosis, treatment response..."></textarea>
          <button type="submit" class="btn btn-primary">Add case</button>
        </form>
        <div id="case-error" class="error-banner hidden"></div>
        <div id="case-list" class="case-list"></div>
        <div id="case-empty" class="empty-state hidden">No case records yet.</div>
      </section>
    </aside>

    <main class="main">
    <!-- 1. Search Medications -->
    <section class="section" id="search-section">
      <h2>üîç Search Medications</h2>
      <p class="section-desc">Tip: Search by specific drug name (e.g. ibuprofen, amoxicillin) for best results. Info from OpenFDA.</p>
      <div class="search-box">
        <div class="input-with-clear">
          <input type="text" id="search-input" placeholder="Enter medication name, e.g. ibuprofen, amoxicillin" maxlength="100" aria-label="Search medications">
          <button type="button" id="search-input-clear" class="input-clear-btn hidden" aria-label="Clear medication search">√ó</button>
          <div id="search-suggestions" class="search-suggestions hidden" role="listbox" aria-label="Medication suggestions"></div>
        </div>
        <button type="button" id="search-btn" class="btn btn-primary">Search</button>
        <button type="button" id="scan-btn" class="btn btn-secondary">Scan Label</button>
      </div>
      <div id="search-results" class="results-grid"></div>
      <div id="search-error" class="error-banner hidden"></div>
    </section>

    <!-- 2. Ask AI -->
    <section class="section" id="ai-section">
      <h2>ü§ñ Ask AI</h2>
      <p class="section-desc">Ask about medication info, dosage, etc. (For reference only‚Äîconsult your doctor)</p>
      <div class="ai-form">
        <label for="ai-question">Your question:</label>
        <div class="input-with-clear">
          <textarea id="ai-question" rows="3" placeholder="e.g. What is the typical adult dosage for ibuprofen?" maxlength="2000" aria-label="Enter question"></textarea>
          <button type="button" id="ai-question-clear" class="input-clear-btn hidden" aria-label="Clear AI question">√ó</button>
        </div>
        <label for="ai-med-context">Related medication (optional):</label>
        <div class="input-with-clear">
          <input type="text" id="ai-med-context" placeholder="Medication name" maxlength="255" aria-label="Related medication">
          <button type="button" id="ai-med-context-clear" class="input-clear-btn hidden" aria-label="Clear related medication">√ó</button>
        </div>
        <button type="button" id="ai-ask-btn" class="btn btn-primary">Ask</button>
      </div>
      <div id="ai-answer" class="ai-answer hidden">
        <div class="answer-content"></div>
        <div id="ai-suggested-meds" class="ai-suggested-meds hidden"></div>
        <div class="answer-disclaimer"></div>
      </div>
      <div id="ai-error" class="error-banner hidden"></div>
    </section>

    <!-- 3. My Pillbox -->
    <section class="section" id="pillbox-section">
      <h2>üì¶ My Pillbox</h2>
      <div id="pillbox-list" class="pillbox-list"></div>
      <div id="pillbox-empty" class="empty-state hidden">No medications yet. Search and add some.</div>
      <div id="pillbox-error" class="error-banner hidden"></div>
    </section>

    <!-- 4. Notifications -->
    <section class="section" id="notifications-section">
      <h2>üîî Notifications</h2>
      <p class="section-desc">Countdown to next dose and reminder history.</p>
      <div class="countdown-section">
        <h3 class="countdown-title">‚è± Next dose countdown</h3>
        <div id="countdown-list" class="countdown-list"></div>
        <div id="countdown-empty" class="empty-state hidden">Add medications and reminder times in My Pillbox to see countdown</div>
      </div>
      <div class="notifications-header">
        <span class="notifications-subtitle">Reminder history</span>
        <button type="button" id="mark-all-read-btn" class="btn btn-secondary btn-small">Mark all read</button>
      </div>
      <div id="notifications-list" class="notifications-list"></div>
      <div id="notifications-empty" class="empty-state hidden">No notifications yet</div>
    </section>
  </main>
  </div>

  <!-- Modal for Camera Scan -->
  <div id="scan-modal" class="modal hidden">
    <div class="modal-content">
      <h3>Scan Medication Label</h3>
      <p class="section-desc">Point the camera at the medication name, then tap "Capture & Detect".</p>
      <div class="scan-video-wrap">
        <video id="scan-video" autoplay playsinline muted></video>
      </div>
      <canvas id="scan-canvas" class="hidden"></canvas>
      <div id="scan-status" class="scan-status">Camera not started</div>
      <div class="modal-actions">
        <button type="button" id="scan-cancel" class="btn btn-secondary">Cancel</button>
        <button type="button" id="scan-capture" class="btn btn-primary">Capture & Detect</button>
      </div>
    </div>
  </div>

  <!-- Modal for Edit Profile -->
  <div id="profile-modal" class="modal hidden">
    <div class="modal-content">
      <h3>Edit Profile</h3>
      <form id="profile-form">
        <label for="profile-age">Age</label>
        <input type="number" id="profile-age-input" min="1" max="150" placeholder="e.g. 35">
        <label for="profile-height-input">Height (cm)</label>
        <input type="number" id="profile-height-input" min="50" max="300" placeholder="e.g. 170">
        <label for="profile-weight-input">Weight (kg)</label>
        <input type="number" id="profile-weight-input" min="20" max="500" placeholder="e.g. 65">
        <label for="profile-state-input">State</label>
        <select id="profile-state-input">
          <option value="">Select state</option>
          <!-- populated by JS -->
        </select>
        <label for="profile-city-input">City / Region</label>
        <select id="profile-city-input">
          <option value="">Select city</option>
          <!-- populated by JS when state selected -->
        </select>
        <div class="modal-actions">
          <button type="button" id="profile-cancel" class="btn btn-secondary">Cancel</button>
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal for Login / Register -->
  <div id="login-modal" class="modal hidden">
    <div class="modal-content login-modal-content">
      <h3>User Login</h3>
      <div class="login-form">
        <label for="login-email">Email:</label>
        <input type="email" id="login-email" placeholder="your@email.com">
        <label for="login-password">Password:</label>
        <input type="password" id="login-password" placeholder="Password">
        <button type="button" id="login-submit" class="btn btn-primary">Login</button>
      </div>
      <div class="oauth-login">
        <button type="button" id="oauth-google-btn" class="btn btn-oauth btn-oauth-google">
          <span class="google-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" focusable="false">
              <path fill="#4285F4" d="M23.49 12.27c0-.79-.07-1.54-.2-2.27H12v4.31h6.44c-.28 1.5-1.12 2.77-2.39 3.62v3h3.86c2.26-2.08 3.58-5.15 3.58-8.66z"/>
              <path fill="#34A853" d="M12 24c3.24 0 5.95-1.07 7.94-2.91l-3.86-3c-1.07.72-2.44 1.15-4.08 1.15-3.14 0-5.8-2.12-6.75-4.97H1.26v3.09C3.24 21.29 7.28 24 12 24z"/>
              <path fill="#FBBC05" d="M5.25 14.27A7.21 7.21 0 0 1 4.87 12c0-.79.14-1.56.38-2.27V6.64H1.26A11.99 11.99 0 0 0 0 12c0 1.93.46 3.76 1.26 5.36l3.99-3.09z"/>
              <path fill="#EA4335" d="M12 4.76c1.76 0 3.35.61 4.6 1.8l3.45-3.45C17.94 1.14 15.24 0 12 0 7.28 0 3.24 2.71 1.26 6.64l3.99 3.09c.95-2.85 3.61-4.97 6.75-4.97z"/>
            </svg>
          </span>
          <span>Continue with Google</span>
        </button>
      </div>
      <p class="login-divider">New User?</p>
      <div class="register-form">
        <label for="register-email">Choose Email:</label>
        <input type="email" id="register-email" placeholder="your@email.com">
        <label for="register-password">Choose Password:</label>
        <input type="password" id="register-password" placeholder="At least 6 characters">
        <label for="register-terms" class="terms-check">
          <input type="checkbox" id="register-terms">
          <span>
            I have read and agree to the
            <a href="terms.html" target="_blank" rel="noopener" class="terms-link">Terms of Educational Use and Privacy Notice</a>.
            I understand that Pillulu Health Assistant is for reference only and does not replace professional medical advice.
          </span>
        </label>
        <button type="button" id="register-submit" class="btn btn-success">Create Account</button>
      </div>
      <button type="button" id="login-modal-close" class="modal-close">√ó</button>
    </div>
  </div>

  <!-- Modal for Add to Pillbox -->
  <div id="med-detail-modal" class="modal hidden">
    <div class="modal-content">
      <h3 id="med-detail-title">Medication details</h3>
      <div id="med-detail-content" class="med-detail-content"></div>
      <div class="modal-actions">
        <button type="button" id="med-detail-close" class="btn btn-secondary">Close</button>
        <button type="button" id="med-detail-add" class="btn btn-primary">Add to Pillbox</button>
      </div>
    </div>
  </div>

  <!-- Modal for Add to Pillbox -->
  <div id="add-med-modal" class="modal hidden">
    <div class="modal-content">
      <h3>Add to Pillbox</h3>
      <form id="add-med-form">
        <label for="add-med-name">Medication name *</label>
        <input type="text" id="add-med-name" required>
        <label for="add-med-purpose">Purpose (optional)</label>
        <input type="text" id="add-med-purpose" placeholder="e.g. pain relief, fever reducer">
        <label for="add-med-stock">Current stock</label>
        <input type="number" id="add-med-stock" min="0" value="10">
        <label for="add-med-threshold">Low stock alert threshold</label>
        <input type="number" id="add-med-threshold" min="0" value="5">
        <label for="add-med-notes">Notes (optional)</label>
        <textarea id="add-med-notes" rows="2"></textarea>
        <div class="modal-actions">
          <button type="button" id="add-med-cancel" class="btn btn-secondary">Cancel</button>
          <button type="submit" class="btn btn-primary">Add</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal for Delete Med Confirmation -->
  <div id="delete-med-modal" class="modal hidden">
    <div class="modal-content">
      <h3>Delete medication</h3>
      <p id="delete-med-message">Are you sure you want to delete this medication?</p>
      <div class="modal-actions">
        <button type="button" id="delete-med-cancel" class="btn btn-secondary">Cancel</button>
        <button type="button" id="delete-med-confirm" class="btn btn-primary" style="background: var(--error);">Delete</button>
      </div>
    </div>
  </div>

  <!-- Modal for Edit Med -->
  <div id="edit-med-modal" class="modal hidden">
    <div class="modal-content">
      <h3>Edit Medication</h3>
      <form id="edit-med-form">
        <input type="hidden" id="edit-med-id">
        <label for="edit-med-name">Medication name *</label>
        <input type="text" id="edit-med-name" required>
        <label for="edit-med-purpose">Purpose (optional)</label>
        <input type="text" id="edit-med-purpose">
        <label for="edit-med-stock">Current stock</label>
        <input type="number" id="edit-med-stock" min="0">
        <label for="edit-med-threshold">Low stock alert threshold</label>
        <input type="number" id="edit-med-threshold" min="0">
        <label for="edit-med-notes">Notes (optional)</label>
        <textarea id="edit-med-notes" rows="2"></textarea>
        <div class="modal-actions">
          <button type="button" id="edit-med-cancel" class="btn btn-secondary">Cancel</button>
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal for Add Schedule -->
  <div id="add-schedule-modal" class="modal hidden">
    <div class="modal-content">
      <h3>Add Reminder Time</h3>
      <form id="add-schedule-form">
        <input type="hidden" id="add-schedule-med-id">
        <label for="add-schedule-time">Time (24-hour)</label>
        <input type="time" id="add-schedule-time" required>
        <label for="add-schedule-timezone">Timezone</label>
        <select id="add-schedule-timezone">
          <option value="America/New_York">US Eastern (America/New_York)</option>
          <option value="America/Los_Angeles">US Pacific (America/Los_Angeles)</option>
          <option value="Europe/London">UK (Europe/London)</option>
          <option value="Asia/Shanghai">China (Asia/Shanghai)</option>
        </select>
        <label>Days to take</label>
        <div class="days-checkboxes" id="add-schedule-days">
          <label class="day-check"><input type="checkbox" data-day="mon"> Mon</label>
          <label class="day-check"><input type="checkbox" data-day="tue"> Tue</label>
          <label class="day-check"><input type="checkbox" data-day="wed"> Wed</label>
          <label class="day-check"><input type="checkbox" data-day="thu"> Thu</label>
          <label class="day-check"><input type="checkbox" data-day="fri"> Fri</label>
          <label class="day-check"><input type="checkbox" data-day="sat"> Sat</label>
          <label class="day-check"><input type="checkbox" data-day="sun"> Sun</label>
        </div>
        <div id="next-reminder-preview" class="next-reminder-preview"></div>
        <div class="modal-actions">
          <button type="button" id="add-schedule-cancel" class="btn btn-secondary">Cancel</button>
          <button type="submit" class="btn btn-primary">Add</button>
        </div>
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
